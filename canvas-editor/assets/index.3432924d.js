var w=Object.defineProperty;var v=(l,t,e)=>t in l?w(l,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):l[t]=e;var f=(l,t,e)=>(v(l,typeof t!="symbol"?t+"":t,e),e);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))n(o);new MutationObserver(o=>{for(const i of o)if(i.type==="childList")for(const s of i.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&n(s)}).observe(document,{childList:!0,subtree:!0});function e(o){const i={};return o.integrity&&(i.integrity=o.integrity),o.referrerpolicy&&(i.referrerPolicy=o.referrerpolicy),o.crossorigin==="use-credentials"?i.credentials="include":o.crossorigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function n(o){if(o.ep)return;o.ep=!0;const i=e(o);fetch(o.href,i)}})();const _=4;class x{constructor(t,e){f(this,"_container");f(this,"_cursor");f(this,"_data");f(this,"_height");f(this,"_top");f(this,"_left");f(this,"_renderDataPosition");f(this,"_dataPosition");this._container=t,this._cursor=null,this._data=e;const n=this._data.getConfg();this._height=n.lineHeight*n.fontSize+_,this._top=n.pageMargin-_/2+1,this._left=n.pageMargin-n.wordSpace/2-.5,this._dataPosition=-1,this._renderDataPosition=[-1,0],this._createCursor(),this.updateCursor()}_createCursor(){const t=document.createElement("div");t.style.width="1px",t.style.position="absolute",t.style.background="black",t.style.display="none",t.style.userSelect="none",t.classList.add("editor-cursor"),this._cursor=t,this._container.append(t)}hideCursor(){this._cursor.style.display="none"}showCursor(){this._cursor.style.display="block"}updateCursor(){if(!this._cursor)return;this._data.getRenderContent().forEach((e,n)=>{(n===this._renderDataPosition[0]||n===0&&this._renderDataPosition[0]===-1)&&this.setCursorHeight(e.height)}),this._cursor.style.left=`${this._left}px`,this._cursor.style.top=`${this._top}px`,this._cursor.style.height=`${this._height}px`}getCursorPosition(t,e,n){const{top:o,textY:i}=this._getTextYCursorPosition(n,e),s=n[i].texts,{left:a,textX:r}=this._getTextXCursorPosition(s,t);return this._renderDataPosition=[i,r],{left:a,textX:r,top:o,textY:i}}setCursorPosition(t,e){const n=this._data.getRenderContent(),{left:o,textX:i,top:s,textY:a}=this.getCursorPosition(t,e,n);this._top=s,this._left=o;let r=0;n.forEach((h,u)=>{u<a&&(r+=h.texts.length)}),this.setDataPosition(r+i)}setCursorPositionByData(){const{top:t,left:e}=this._getLineCursorPositionByData();this._left=e,this._top=t}_getLineCursorPositionByData(){const t=this._data.getConfg();let e=t.pageMargin-_/2+1,n=t.pageMargin-t.wordSpace/2-.5;const o=this._data.getRenderContent();if(o.length>0){for(const[i,s]of o.entries()){if(this._renderDataPosition[0]===i)break;e=e+s.height*t.lineHeight}for(const[i,s]of o[this._renderDataPosition[0]].texts.entries()){if(this._renderDataPosition[1]<i)break;n=n+s.width+t.wordSpace}}return{top:e,left:n}}_getTextYCursorPosition(t,e){const n=this._data.getConfg();let o=n.pageMargin-_/2+1,i=0;const s=t.length;for(const[a,r]of t.entries()){if(e<o+r.height*n.lineHeight)break;a+1<s&&(i++,o=o+r.height*n.lineHeight)}return{top:o,textY:i}}_getTextXCursorPosition(t,e){const n=this._data.getConfg();let o=n.pageMargin-n.wordSpace/2-.5,i=-1;for(const s of t){if(e<o+s.width/2)break;i++,o=o+s.width+n.wordSpace}return i===t.length-1&&i--,{left:o,textX:i}}setCursorHeight(t){const e=this._data.getConfg();this._height=t*e.lineHeight+_}setRenderDataPosition(){if(this._dataPosition===-1)this._renderDataPosition=[0,-1];else{const t=this._data.getRenderContent();let e=0;for(const[n,o]of t.entries())if(this._dataPosition<e+o.texts.length-1){this._renderDataPosition=[n,this._dataPosition-e];break}else e=e+o.texts.length}}getRenderDataPosition(){return this._renderDataPosition}setDataPosition(t){t<-1||t>=this._data.getLength()-1||(this._dataPosition=t,this.setRenderDataPosition())}getDataPosition(){return this._dataPosition}}var c=(l=>(l.ENTER="Enter",l.BACKSPACE="Backspace",l.LEFT="ArrowLeft",l.TOP="ArrowUp",l.RIGHT="ArrowRight",l.BOTTOM="ArrowDown",l.S="s",l))(c||{});class z{constructor(){f(this,"onSelectChange");f(this,"onCursorChange");this.onSelectChange=null,this.onCursorChange=null}}class P{constructor(t){f(this,"_textarea");f(this,"_container");this._container=t,this._textarea=this._createTextarea()}_createTextarea(){const t=document.createElement("textarea");return t.style.position="absolute",t.style.zIndex="-100",t.style.right="100px",t.style.background="transparent",t.style.border="none",t.style.resize="none",t.style.outline="none",t.style.color="transparent",this._container.append(t),t}getTextareaElement(){return this._textarea}}const W=new RegExp("[\u4E00-\u9FA5]+"),D=new RegExp("[\u300A\u300B~\uFF01@#\uFFE5\u2026\u2026&*\uFF08\uFF09\u2014\u2014|{}\u3010\u3011\u2018\uFF1B\uFF1A\u201D\u201C'\u3002\uFF0C\u3001\uFF1F]"),T=l=>W.test(l)||D.test(l),F=l=>l&&JSON.parse(JSON.stringify(l));class k{constructor(t,e){f(this,"listener");f(this,"_container");f(this,"_canvas");f(this,"_ctx");f(this,"_textarea");f(this,"_data");f(this,"_cursor");f(this,"_selectArea");f(this,"_click");this.listener=new z,this._container=t,this._selectArea=null,this._click=null;const{canvas:n,ctx:o}=this._createCanvas();this._canvas=n,this._ctx=o,this._data=e,this._data.setPageWidth(this._canvas.width);const i=new P(this._container);this._textarea=i.getTextareaElement(),this._cursor=new x(this._container,this._data),this._bindEvents(),this._renderRichText()}get config(){return this._data.getConfg()}get isSelectContent(){return this._selectArea&&(this._selectArea[0]!==this._selectArea[2]||this._selectArea[1]!==this._selectArea[3])}_forSelectTexts(t){if(this._selectArea){const e=this._data.getRenderContent(),[n,o,i,s]=this._selectArea;e.forEach((a,r)=>{r>=o&&r<=s&&a.texts.forEach((h,u)=>{n<=u&&u<i&&t&&t(h)})}),this._renderRichText()}}setFontColor(t){this._forSelectTexts(e=>{e.fontColor=t})}setFontSize(t){this._forSelectTexts(e=>{t==="large"?e.fontSize+=2:e.fontSize-=2;const{width:n,height:o}=this._getFontSize(e);e.width=n,e.height=o})}setFontBold(t){this._forSelectTexts(e=>{e.fontWeight=t?"bold":"normal";const{width:n,height:o}=this._getFontSize(e);e.width=n,e.height=o})}setFontItalic(t){this._forSelectTexts(e=>{e.fontStyle=t?"italic":"normal";const{width:n,height:o}=this._getFontSize(e);e.width=n,e.height=o})}setFontUnderLine(t){this._forSelectTexts(e=>{e.underline=t})}setFontStrikeout(t){this._forSelectTexts(e=>{e.strikout=t})}_createCanvas(){const t=this._container.clientWidth,e=this._container.clientHeight,n=document.createElement("canvas");n.style.background="#fff";const o=window.devicePixelRatio;n.width=t*o,n.height=e*o;const i=n.getContext("2d");return i.scale(o,o),this._container.append(n),{canvas:n,ctx:i}}_bindEvents(){this._canvas.addEventListener("mousedown",this._onMouseDown.bind(this)),this._canvas.addEventListener("mousemove",this._onMouseMove.bind(this)),this._canvas.addEventListener("mouseup",this._onMouseUp.bind(this)),this._canvas.addEventListener("mouseout",this._onMouseUp.bind(this)),this._textarea.addEventListener("change",t=>{console.log("==== change",t)}),this._textarea.addEventListener("focus",t=>{console.log("==== focus",t)}),this._textarea.addEventListener("input",t=>this._onInput(t)),this._textarea.addEventListener("compositionend",t=>this._onCompEnd(t)),this._textarea.addEventListener("keydown",t=>this._onKeydown(t))}_onMouseDown(t){const e=this._data.getRenderContent(),{textX:n,textY:o}=this._cursor.getCursorPosition(t.offsetX,t.offsetY,e);this._click={x:t.offsetX,y:t.offsetY,textX:n+1,textY:o},this._cursor.hideCursor(),this._selectArea=null,this._renderRichText()}_onMouseMove(t){if(t.preventDefault(),this._click){const e=this._data.getRenderContent(),{textX:n,textY:o}=this._cursor.getCursorPosition(t.offsetX,t.offsetY,e);let i=this._click.textX,s=this._click.textY,a=n+1,r=o;r<s?(a=this._click.textX,r=this._click.textY,i=n+1,s=o):r===s&&i>a&&(a=this._click.textX,i=n+1),this._selectArea=[i,s,a,r],this._renderRichText()}}_onMouseUp(t){t.preventDefault(),this.isSelectContent?this._dealCurrentSelectStyle():(this._focus(t.offsetX,t.offsetY),this._selectArea=null),this._click=null}_dealCurrentSelectStyle(){const t=this.config,e={fontWeight:"bold",fontSize:t.fontSize,fontColor:t.fontColor,fontFamily:t.fontFamily,fontStyle:"italic",underline:!0,strikout:!0};this._forSelectTexts(n=>{n.fontWeight==="normal"&&(e.fontWeight="normal"),e.fontSize&&n.fontSize!==e.fontSize&&delete e.fontSize,e.fontColor&&n.fontColor!==e.fontColor&&delete e.fontColor,e.fontFamily&&n.fontFamily!==e.fontFamily&&delete e.fontFamily,e.fontStyle&&n.fontStyle!==e.fontStyle&&delete e.fontStyle,e.underline&&!n.underline&&delete e.underline,e.strikout&&!n.strikout&&delete e.strikout}),this.listener.onSelectChange&&this.listener.onSelectChange(e)}_focus(t,e){this._cursor.setCursorPosition(t,e),this._cursor.updateCursor(),this._cursor.showCursor(),this._updateFontStyleByCursorFont(),setTimeout(()=>{this._textarea.focus()},100)}_updateFontStyleByCursorFont(){const t=this._cursor.getDataPosition(),e=this._data.getContent(),n=t===-1?this._data.getConfg():e[t],o={fontSize:n.fontSize,fontColor:n.fontColor,fontFamily:n.fontFamily,fontStyle:n.fontStyle,fontWeight:n.fontWeight,underline:!!n.underline,strikout:!!n.strikout};this._data.updateConfig(o),this.listener.onCursorChange&&this.listener.onCursorChange(o)}_onInput(t){t.inputType==="insertText"&&t.data&&this._inputText(t.data)}_onCompEnd(t){t.data&&t.data.split("").forEach(n=>{this._inputText(n)})}_onKeydown(t){switch(t.key){case c.LEFT:{t.preventDefault();const e=this._cursor.getDataPosition();this._cursor.setDataPosition(e-1),this._cursor.setCursorPositionByData(),this._cursor.updateCursor(),this._updateFontStyleByCursorFont();break}case c.RIGHT:{t.preventDefault();const e=this._cursor.getDataPosition();this._cursor.setDataPosition(e+1),this._cursor.setCursorPositionByData(),this._cursor.updateCursor(),this._updateFontStyleByCursorFont();break}case c.TOP:{t.preventDefault();const e=this._cursor.getDataPosition(),n=this._cursor.getRenderDataPosition();if(n[0]>0){const o=this._data.getStashRenderContent(),i=o[n[0]].texts;let s=0;for(const[u,d]of i.entries())u<=n[1]&&(s+=d.width);const a=o[n[0]-1].texts;let r=-1,h=0;for(const u of a)if(h<=s)r++,h+=u.width;else break;r===-1&&(r=0),this._cursor.setDataPosition(e-(n[1]+1+a.length-r)),this._cursor.setCursorPositionByData(),this._cursor.updateCursor(),this._updateFontStyleByCursorFont()}break}case c.BOTTOM:{t.preventDefault();const e=this._cursor.getDataPosition(),n=this._cursor.getRenderDataPosition(),o=this._data.getStashRenderContent();if(n[0]<o.length-1){const i=o[n[0]].texts;let s=0;for(const[u,d]of i.entries())u<=n[1]&&(s+=d.width);const a=o[n[0]+1].texts;let r=-1,h=0;for(const u of a)if(h<=s)r++,h+=u.width;else break;r===-1&&(r=0),this._cursor.setDataPosition(e+(i.length-(n[1]+1)+r)),this._cursor.setCursorPositionByData(),this._cursor.updateCursor(),this._updateFontStyleByCursorFont()}break}case c.ENTER:{t.preventDefault();const e=this._data.getConfg(),n={value:`
`,fontSize:e.fontSize,fontFamily:e.fontFamily,fontWeight:e.fontWeight,fontColor:e.fontColor,fontStyle:e.fontStyle,width:0,height:0,isChinese:!1},o=this._cursor.getDataPosition();this._data.addContent(n,o+1),this._cursor.setDataPosition(o+1),this._cursor.setCursorPositionByData(),this._cursor.updateCursor(),this._renderRichText();break}case c.BACKSPACE:{t.preventDefault(),this._deleteText();break}case c.S:{(t.ctrlKey||t.metaKey)&&(t.preventDefault(),console.log(JSON.stringify(this._data.getContent())));break}}}_deleteText(t=0){const e=this._cursor.getDataPosition();this._data.deleteContent(e+t)&&(t===0&&(this._cursor.setDataPosition(e-1),this._cursor.setCursorPositionByData(),this._cursor.updateCursor()),this._renderRichText())}_inputText(t){const e=this._data.getConfg(),n={value:t,fontSize:e.fontSize,fontFamily:e.fontFamily,fontWeight:e.fontWeight,fontColor:e.fontColor,fontStyle:e.fontStyle,width:e.fontSize,height:e.fontSize,isChinese:T(t)},{width:o,height:i}=this._getFontSize(n);n.width=o,n.height=i;const s=this._cursor.getDataPosition();this._data.addContent(n,s+1),this._cursor.setDataPosition(s+1),this._cursor.setCursorPositionByData(),this._cursor.updateCursor(),this._renderRichText(),this._textarea.value=""}_getFontSize(t){this._ctx.font=`${t.fontStyle} ${t.fontWeight} ${t.fontSize}px ${t.fontFamily}`;const e=this._ctx.measureText(t.value),n=e.width,o=e.actualBoundingBoxAscent+e.actualBoundingBoxDescent;return{width:n,height:o}}_clear(){this._ctx.clearRect(0,0,this._canvas.width,this._canvas.height)}_renderRange({x:t,y:e,width:n,height:o}){this._ctx.save(),this._ctx.globalAlpha=.6,this._ctx.fillStyle="#AECBFA",this._ctx.fillRect(t,e,n,o),this._ctx.restore()}_renderRichText(){this._clear();const t=this._data.getRenderContent(),e=this._data.getConfg();let n=e.pageMargin,o=e.pageMargin;t.forEach((i,s)=>{if(this._selectArea){const r=this._data.getRenderSelect(n,o,i,s,this._selectArea);r&&this._renderRange(r)}const a=i.height*e.lineHeight;i.texts.forEach(r=>{r.value!==`
`&&(r.underline&&this._drawUnderLine(r,n,o,i.height),r.strikout&&this._drawStrikout(r,n,o,i.height),this._fillText(r,n,o,i.height),n=n+r.width+e.wordSpace)}),n=e.pageMargin,o=o+a})}_drawStrikout(t,e,n,o){const i=this._data.getConfg(),s=o+o*(i.lineHeight-1)/2,a=(o-t.fontSize)*.1,r=n+s+2-t.fontSize/2-a;this._ctx.save(),this._ctx.beginPath(),this._ctx.lineWidth=t.fontSize/10,this._ctx.strokeStyle=t.fontColor;const h=Math.sign(this._ctx.lineWidth-2)*.2;this._ctx.moveTo(e-i.wordSpace/2-h,r),this._ctx.lineTo(e+t.width+i.wordSpace/2+h,r),this._ctx.stroke(),this._ctx.restore()}_drawUnderLine(t,e,n,o){const i=this._data.getConfg(),s=o+o*(i.lineHeight-1)/2,a=n+s+2;this._ctx.save(),this._ctx.beginPath(),this._ctx.lineWidth=Math.ceil(o/20),this._ctx.strokeStyle=t.fontColor;const r=Math.sign(this._ctx.lineWidth-2)*.2;this._ctx.moveTo(e-i.wordSpace/2-r,a),this._ctx.lineTo(e+t.width+i.wordSpace/2+r,a),this._ctx.stroke(),this._ctx.restore()}_fillText(t,e,n,o){this._ctx.save(),this._ctx.textBaseline="bottom";const i=this._data.getConfg();this._ctx.fillStyle=t.fontColor,this._ctx.font=`${t.fontStyle} ${t.fontWeight} ${t.fontSize}px ${t.fontFamily}`;const s=(o-t.fontSize)*.1,a=o+o*(i.lineHeight-1)/2-s;this._ctx.fillText(t.value,e,n+a,t.fontSize),this._ctx.restore()}}const L=[{value:"c",fontSize:16,width:8.751998901367188,height:8.720000267028809,fontStyle:"normal",fontWeight:"normal",fontFamily:"\u6977\u4F53",fontColor:"#f60000",isChinese:!1,underline:!0},{value:"a",fontSize:16,width:8.943984985351562,height:8.720000267028809,fontStyle:"normal",fontWeight:"normal",fontFamily:"\u6977\u4F53",fontColor:"#f60000",isChinese:!1,underline:!0},{value:"n",fontSize:16,width:8.943984985351562,height:8.496000289916992,fontStyle:"normal",fontWeight:"normal",fontFamily:"\u6977\u4F53",fontColor:"#f60000",isChinese:!1,underline:!0},{value:"a",fontSize:56,width:31.303985595703125,height:30.520000457763672,fontStyle:"normal",fontWeight:"normal",fontFamily:"\u6977\u4F53",fontColor:"#f60000",isChinese:!1,underline:!0},{value:"s",fontSize:56,width:28.279998779296875,height:30.520000457763672,fontStyle:"normal",fontWeight:"normal",fontFamily:"\u6977\u4F53",fontColor:"#f60000",isChinese:!1,underline:!0},{value:"\u5BCC",fontSize:56,width:56,height:51.85600280761719,fontStyle:"normal",fontWeight:"normal",fontFamily:"\u6977\u4F53",fontColor:"#444",isChinese:!0,underline:!0},{value:"\u6587",fontSize:56,width:56,height:51.96800231933594,fontStyle:"normal",fontWeight:"normal",fontFamily:"\u6977\u4F53",fontColor:"#444",isChinese:!0,underline:!0},{value:"\u672C",fontSize:56,width:56,height:51.183998107910156,fontStyle:"normal",fontWeight:"normal",fontFamily:"\u6977\u4F53",fontColor:"#444",isChinese:!0,underline:!0},{value:"\u6E32",fontSize:56,width:56,height:51.407997131347656,fontStyle:"normal",fontWeight:"normal",fontFamily:"\u6977\u4F53",fontColor:"#444",isChinese:!0,underline:!0},{value:"\u67D3",fontSize:56,width:56,height:51.183998107910156,fontStyle:"normal",fontWeight:"normal",fontFamily:"\u6977\u4F53",fontColor:"#444",isChinese:!0,underline:!0},{value:"c",fontSize:56,width:30.631988525390625,height:30.520000457763672,fontStyle:"normal",fontWeight:"normal",fontFamily:"\u6977\u4F53",fontColor:"#f60000",isChinese:!1,underline:!0},{value:"a",fontSize:56,width:31.303985595703125,height:30.520000457763672,fontStyle:"normal",fontWeight:"normal",fontFamily:"\u6977\u4F53",fontColor:"#f60000",isChinese:!1,underline:!0},{value:"n",fontSize:56,width:31.303985595703125,height:29.736000061035156,fontStyle:"normal",fontWeight:"normal",fontFamily:"\u6977\u4F53",fontColor:"#f60000",isChinese:!1,underline:!0},{value:"a",fontSize:56,width:31.303985595703125,height:30.520000457763672,fontStyle:"normal",fontWeight:"normal",fontFamily:"\u6977\u4F53",fontColor:"#f60000",isChinese:!1,underline:!0},{value:"s",fontSize:56,width:28.279998779296875,height:30.520000457763672,fontStyle:"normal",fontWeight:"normal",fontFamily:"\u6977\u4F53",fontColor:"#f60000",isChinese:!1,underline:!0},{value:"\u5BCC",fontSize:62,width:62,height:57.41200256347656,fontStyle:"normal",fontWeight:"normal",fontFamily:"\u6977\u4F53",fontColor:"#444",isChinese:!0,underline:!0},{value:"\u6587",fontSize:62,width:62,height:57.53600311279297,fontStyle:"normal",fontWeight:"normal",fontFamily:"\u6977\u4F53",fontColor:"#444",isChinese:!0,underline:!0},{value:"\u672C",fontSize:16,width:16,height:15.37600040435791,fontStyle:"normal",fontWeight:"normal",fontFamily:"\u6977\u4F53",fontColor:"#444",isChinese:!0,underline:!0},{value:"\u6E32",fontSize:16,width:16,height:14.592000007629395,fontStyle:"normal",fontWeight:"normal",fontFamily:"\u6977\u4F53",fontColor:"#444",isChinese:!0,underline:!0},{value:"\u67D3",fontSize:16,width:16,height:15.35999870300293,fontStyle:"normal",fontWeight:"normal",fontFamily:"\u6977\u4F53",fontColor:"#444",isChinese:!0,underline:!0},{value:"c",fontSize:16,width:8.751998901367188,height:8.720000267028809,fontStyle:"normal",fontWeight:"normal",fontFamily:"\u6977\u4F53",fontColor:"#f60000",isChinese:!1,underline:!0},{value:"a",fontSize:16,width:8.943984985351562,height:8.720000267028809,fontStyle:"normal",fontWeight:"normal",fontFamily:"\u6977\u4F53",fontColor:"#f60000",isChinese:!1,underline:!0},{value:"n",fontSize:16,width:8.943984985351562,height:8.496000289916992,fontStyle:"normal",fontWeight:"normal",fontFamily:"\u6977\u4F53",fontColor:"#f60000",isChinese:!1,underline:!0},{value:"a",fontSize:16,width:8.943984985351562,height:8.720000267028809,fontStyle:"normal",fontWeight:"normal",fontFamily:"\u6977\u4F53",fontColor:"#f60000",isChinese:!1,underline:!0},{value:"s",fontSize:16,width:8.079986572265625,height:8.720000267028809,fontStyle:"normal",fontWeight:"normal",fontFamily:"\u6977\u4F53",fontColor:"#f60000",isChinese:!1,underline:!0},{value:"\u5BCC",fontSize:16,width:16,height:15.26400089263916,fontStyle:"normal",fontWeight:"normal",fontFamily:"\u6977\u4F53",fontColor:"#444",isChinese:!0,underline:!0},{value:"\u6587",fontSize:16,width:16,height:14.831999778747559,fontStyle:"normal",fontWeight:"normal",fontFamily:"\u6977\u4F53",fontColor:"#444",isChinese:!0,underline:!0},{value:"\u672C",fontSize:16,width:16,height:15.37600040435791,fontStyle:"normal",fontWeight:"normal",fontFamily:"\u6977\u4F53",fontColor:"#444",isChinese:!0,underline:!0},{value:"\u6E32",fontSize:16,width:16,height:14.592000007629395,fontStyle:"normal",fontWeight:"normal",fontFamily:"\u6977\u4F53",fontColor:"#444",isChinese:!0,underline:!0},{value:"\u67D3",fontSize:16,width:16,height:15.35999870300293,fontStyle:"normal",fontWeight:"normal",fontFamily:"\u6977\u4F53",fontColor:"#444",isChinese:!0,underline:!0},{value:`
`,fontSize:16,width:0,height:0,fontStyle:"normal",fontWeight:"normal",fontFamily:"\u6977\u4F53",fontColor:"#444",isChinese:!1,underline:!0},{value:"c",fontSize:16,width:8.751998901367188,height:8.720000267028809,fontStyle:"normal",fontWeight:"normal",fontFamily:"\u6977\u4F53",fontColor:"#f60000",isChinese:!1},{value:"a",fontSize:16,width:8.943984985351562,height:8.720000267028809,fontStyle:"normal",fontWeight:"normal",fontFamily:"\u6977\u4F53",fontColor:"#f60000",isChinese:!1},{value:"n",fontSize:16,width:8.943984985351562,height:8.496000289916992,fontStyle:"normal",fontWeight:"normal",fontFamily:"\u6977\u4F53",fontColor:"#f60000",isChinese:!1},{value:"a",fontSize:16,width:8.943984985351562,height:8.720000267028809,fontStyle:"normal",fontWeight:"normal",fontFamily:"\u6977\u4F53",fontColor:"#f60000",isChinese:!1},{value:"s",fontSize:16,width:8.079986572265625,height:8.720000267028809,fontStyle:"normal",fontWeight:"normal",fontFamily:"\u6977\u4F53",fontColor:"#f60000",isChinese:!1},{value:"\u5BCC",fontSize:16,width:16,height:15.26400089263916,fontStyle:"normal",fontWeight:"normal",fontFamily:"\u6977\u4F53",fontColor:"#444",isChinese:!0},{value:"\u6587",fontSize:16,width:16,height:14.831999778747559,fontStyle:"normal",fontWeight:"normal",fontFamily:"\u6977\u4F53",fontColor:"#444",isChinese:!0},{value:"\u672C",fontSize:16,width:16,height:15.37600040435791,fontStyle:"normal",fontWeight:"normal",fontFamily:"\u6977\u4F53",fontColor:"#444",isChinese:!0},{value:"\u6E32",fontSize:16,width:16,height:14.592000007629395,fontStyle:"normal",fontWeight:"normal",fontFamily:"\u6977\u4F53",fontColor:"#444",isChinese:!0,strikout:!0},{value:"\u67D3",fontSize:16,width:16,height:15.35999870300293,fontStyle:"normal",fontWeight:"normal",fontFamily:"\u6977\u4F53",fontColor:"#444",isChinese:!0,strikout:!0},{value:`
`,fontSize:16,width:0,height:0,fontStyle:"normal",fontWeight:"normal",fontFamily:"\u6977\u4F53",fontColor:"#444",isChinese:!1}],p={fontSize:16,fontWeight:"normal",fontFamily:"\u6977\u4F53",fontColor:"#444",fontStyle:"normal",wordSpace:1,lineHeight:2,lineHeightLeave:4,pageMargin:10,pageWidth:200};class E{constructor(){f(this,"_content");f(this,"_renderContent");f(this,"_config");this._content=L,this._config=F(p),this._renderContent=[]}resetConfig(){this._config=F(p)}updateConfig(t){this._config={...this._config,...t}}getContent(){return this._content}getRenderContent(){const t=this._config.pageWidth-this._config.pageMargin*2,e=[];let n={height:0,texts:[]},o=0;return this._content.forEach(i=>{n.height===0&&(n.height=i.fontSize),i.value===`
`?(n.texts.push(i),e.push(n),n={height:0,texts:[]},o=0):o+i.width<t?(n.texts.push(i),n.height<i.fontSize&&(n.height=i.fontSize),o=o+i.width+this._config.wordSpace):(e.push(n),n={height:0,texts:[i]},o=i.width+this._config.wordSpace)}),this._renderContent=e,e}getRenderSelect(t,e,n,o,i){if(o>=i[1]&&o<=i[3]){let s=0,a=0;if(i[1]===i[3]?(s=i[0],a=i[2]):i[1]===o?(s=i[0],a=n.texts.length):o<i[3]?(s=0,a=n.texts.length):o===i[3]&&(s=0,a=i[2]),s===a)return;s>0&&(t+=n.texts.slice(0,s).map(h=>h.width).reduce((h,u)=>h+u+this._config.wordSpace));const r=n.texts.slice(s,a).map(h=>h.width).reduce((h,u)=>h+u+this._config.wordSpace);return{x:t,y:e,width:r+this._config.wordSpace,height:n.height*this._config.lineHeight}}}getStashRenderContent(){return this._renderContent}setPageWidth(t){this._config.pageWidth=t}getLength(){return this._content.length}getConfg(){return this._config}addContent(t,e){this._content.splice(e,0,t)}deleteContent(t){return t>=this._content.length||t===-1?!1:(this._content.splice(t,1),!0)}}window.onload=()=>{const l=document.querySelector("#editor"),t=new E,e=new k(l,t);console.log("\u5B9E\u4F8B",e);let n=!1,o=!1,i=!1,s=!1;const a=document.querySelector(".tool-btn-bold"),r=document.querySelector(".tool-btn-italic"),h=document.querySelector(".tool-btn-underline"),u=document.querySelector(".tool-btn-strikeout"),d=g=>{n=g.fontWeight==="bold",o=g.fontStyle==="italic",i=!!g.underline,s=!!g.strikout,C(),S(),m(),y()};e.listener.onSelectChange=d,e.listener.onCursorChange=d;const C=()=>{n?a==null||a.classList.add("active"):a==null||a.classList.remove("active")},S=()=>{o?r==null||r.classList.add("active"):r==null||r.classList.remove("active")},m=()=>{i?h==null||h.classList.add("active"):h==null||h.classList.remove("active")},y=()=>{s?u==null||u.classList.add("active"):u==null||u.classList.remove("active")};window.setFontColor=g=>{e.setFontColor(g.target.value)},window.setAddFontSize=()=>{e.setFontSize("large")},window.setReduceFontSize=()=>{e.setFontSize("small")},window.setFontBold=()=>{e.isSelectContent&&(n=!n,e.setFontBold(n),C())},window.setFontItalic=()=>{e.isSelectContent&&(o=!o,e.setFontItalic(o),S())},window.setFontUnderLine=()=>{e.isSelectContent&&(i=!i,e.setFontUnderLine(i),m())},window.setFontStrikeout=()=>{e.isSelectContent&&(s=!s,e.setFontStrikeout(s),y())}};
