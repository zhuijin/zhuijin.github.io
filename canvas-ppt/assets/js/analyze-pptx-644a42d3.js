var t=Object.defineProperty,e=(e,l,i)=>(((e,l,i)=>{l in e?t(e,l,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[l]=i})(e,"symbol"!=typeof l?l+"":l,i),i);import{J as l}from"./jszip-d3992526.js";import{X as i}from"./x2js-dc120f56.js";import{h as s}from"./d3-color-e929203e.js";class r{constructor(t){e(this,"_theme"),this._theme=t.theme.themeElements}get theme(){return this._theme}}class a{constructor(t,l){var i,r,a,o,n;if(e(this,"color",""),e(this,"_val",""),e(this,"alpha","100000"),t.schemeClr){this._val=t.schemeClr._val,this.alpha=null==(i=t.schemeClr.alpha)?void 0:i._val;const e=null==(r=l.clrScheme[this._val])?void 0:r.srgbClr;if(e){this.color=("#"+e._val).toLocaleUpperCase();let l=s(this.color);if(t.schemeClr.lumMod||t.schemeClr.lumOff){const e=(+(null==(a=t.schemeClr.lumMod)?void 0:a._val)||0)/1e5,i=(+(null==(o=t.schemeClr.lumOff)?void 0:o._val)||0)/1e5;0!=i&&(l.l=100*(l.l*(e/100)+i/100))}if(t.schemeClr.tint){const e=+t.schemeClr.tint._val/1e3,i=l.rgb();i.r=i.r*e/100+255*(1-e/100),i.g=i.g*e/100+255*(1-e/100),i.b=i.b*e/100+255*(1-e/100),l=s(i)}this.color=l.hex().toLocaleUpperCase()}}else t.srgbClr?(this.alpha=null==(n=t.srgbClr.alpha)?void 0:n._val,this.color=("#"+t.srgbClr._val).toLocaleUpperCase()):t.prstClr&&(this.color=t.prstClr._val)}}class o extends a{constructor(t,e){super(t,e)}}class n{constructor(t,l){e(this,"_blipFill"),e(this,"_relationships"),this._blipFill=t,this._relationships=l}get src(){const t=this._blipFill.blip["_r:embed"],e=this._relationships.find((e=>e._Id===t));return(null==e?void 0:e._Target)||""}get opacity(){var t;return+((null==(t=this._blipFill.blip.alphaModFix)?void 0:t._amt)||0)/1e3}get stretch(){return this._blipFill.stretch}get tile(){return this._blipFill.tile}}class h{constructor(t,l){e(this,"_gradFill"),e(this,"_theme"),this._gradFill=t,this._theme=l}get color(){return this._gradFill.gsLst.gs.map((t=>{const e=new o(t,this._theme);let l=e.color;if(e.alpha){const t=+e.alpha/1e5;l=(l+Math.floor(255*t).toString(16)).toLocaleUpperCase()}return l?{pos:t._pos,value:l}:{}})).filter((t=>!!t.value))}get rotate(){if(this._gradFill.lin){const t=+(this._gradFill.lin._ang||0)/6e4-90;return t<0?360+t:t}return 0}get type(){return this._gradFill.lin?"linear":this._gradFill.path?"radial":"linear"}}class c{constructor(t,l,i){e(this,"_type","solid"),e(this,"_solidFill",null),e(this,"_blipFill",null),e(this,"_gradFill",null),e(this,"_relationships"),this._relationships=i,t.bgPr.solidFill&&(this._solidFill=new o(t.bgPr.solidFill,l),this._type="solid"),t.bgPr.blipFill&&(this._blipFill=new n(t.bgPr.blipFill,this._relationships),this._type="image"),t.bgPr.gradFill&&(this._gradFill=new h(t.bgPr.gradFill,l),this._type="gradient")}get type(){return this._type}get color(){let t=this._solidFill.color;if(this._solidFill.alpha){const e=+this._solidFill.alpha/1e5;t=(t+Math.floor(255*e).toString(16)).toLocaleUpperCase()}return t||""}get gradientColor(){var t;return null==(t=this._gradFill)?void 0:t.color.map((t=>({offset:+t.pos/1e5,value:t.value})))}get gradientType(){return this._gradFill.type}get gradientRotate(){return this._gradFill.rotate}get imageSrc(){var t;return(null==(t=this._blipFill)?void 0:t.src.replace("..","ppt"))||""}get stretch(){var t;return(null==(t=this._blipFill)?void 0:t.stretch)||""}get tile(){var t;return(null==(t=this._blipFill)?void 0:t.tile)||""}}class p{constructor(t,l){e(this,"_style"),e(this,"_theme"),this._style=t,this._theme=l}get fill(){if(this._style&&this._style.fillRef){return new o(this._style.fillRef,this._theme).color}return""}get ln(){if(this._style&&this._style.lnRef){return new o(this._style.lnRef,this._theme).color}return""}}const d=(t=6)=>{const e="_0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz";let l="";for(let i=0;i<t;i++){l+=e[Math.floor(63*Math.random())]}return l},_=t=>{if(!isNaN(t))return+t/12700/3*4},f=(t=0)=>Math.round(t/6e4);var u,g;(g=u||(u={})).rect="rect",g.roundRect="rectRadius",g.snip1Rect="rectMinusSingleAngle",g.snip2SameRect="rectMinusSameSideAngle",g.snip2DiagRect="rectMinusOppositeAngle",g.snipRoundRect="rectSingleRadiusMinusSingleAngle",g.round1Rect="rectSingleRadius",g.round2SameRect="rectSameSideRadius",g.round2DiagRect="rectOppositeRadius",g.ellipse="oval",g.triangle="triangle",g.rtTriangle="rightTriangle",g.parallelogram="parallelogram",g.trapezoid="trapezoidal",g.diamond="diamond",g.pentagon="pentagon",g.hexagon="hexagon",g.heptagon="heptagon",g.octagon="octagon",g.decagon="decagon",g.dodecagon="dodecagon",g.pie="pieShape",g.chord="chordShape",g.teardrop="teardropShape",g.frame="frameShape",g.halfFrame="halfClosedFrameShape",g.corner="horn",g.diagStripe="twill",g.plus="cross",g.plaque="cutawayRectangle",g.donut="ring";const m={title:"title",subTitle:"body",ctrTitle:"title"},y=[{label:"Arial",value:"Arial"},{label:"微软雅黑",value:"Microsoft YaHei"},{label:"宋体",value:"SimSun"},{label:"黑体",value:"SimHei"},{label:"楷体",value:"KaiTi"},{label:"新宋体",value:"NSimSun"},{label:"仿宋",value:"FangSong"},{label:"苹方",value:"PingFang SC"},{label:"华文黑体",value:"STHeiti"},{label:"华文楷体",value:"STKaiti"},{label:"华文宋体",value:"STSong"},{label:"华文仿宋",value:"STFangSong"},{label:"华文中宋",value:"STZhongSong"},{label:"华文琥珀",value:"STHupo"},{label:"华文新魏",value:"STXinwei"},{label:"华文隶书",value:"STLiti"},{label:"华文行楷",value:"STXingkai"},{label:"冬青黑体",value:"Hiragino Sans GB"},{label:"兰亭黑",value:"Lantinghei SC"},{label:"偏偏体",value:"Hanzipen SC"},{label:"手札体",value:"Hannotate SC"},{label:"宋体",value:"Songti SC"},{label:"娃娃体",value:"Wawati SC"},{label:"行楷",value:"Xingkai SC"},{label:"圆体",value:"Yuanti SC"},{label:"华文细黑",value:"STXihei"},{label:"幼圆",value:"YouYuan"},{label:"隶书",value:"LiSu"}];class v{constructor(t,l,i,s){e(this,"_sps",[]),e(this,"_theme"),e(this,"_sldLayout"),e(this,"_sldMaster"),e(this,"_ctx"),e(this,"_titleLvlPprs",[]),e(this,"_bodyLvlPprs",[]),e(this,"_otherLvlPprs",[]),e(this,"_layoutStyle",{}),this._theme=l,this._sldLayout=i,this._sldMaster=s;const r=t instanceof Array;this._sps=r?t:[t];const a=document.createElement("canvas");a.style.width="100px",a.style.height="100px";const o=window.devicePixelRatio;a.width=100*o,a.height=100*o,this._ctx=a.getContext("2d",{willReadFrequently:!0}),this._ctx.scale(o,o),this._titleLvlPprs=this.dealTexStyle(this._sldMaster.txStyles.titleStyle),this._bodyLvlPprs=this.dealTexStyle(this._sldMaster.txStyles.bodyStyle),this._otherLvlPprs=this.dealTexStyle(this._sldMaster.txStyles.otherStyle),this._layoutStyle=this.dealLayoutStyle()}getFontSize(t){this._ctx.font=`${t.fontStyle} ${t.fontWeight} ${t.fontSize}px ${t.fontFamily}`;const e=this._ctx.measureText(t.value);return{width:e.width,height:e.actualBoundingBoxAscent+e.actualBoundingBoxDescent}}dealTexStyle(t){var e,l;const i=[];for(const s in t)if(s.indexOf("lvl")>-1){const r=t[s].defRPr;let a="";if(null==(l=null==(e=r.solidFill)?void 0:e.schemeClr)?void 0:l._val){r.solidFill.schemeClr._val=this._sldMaster.clrMap["_"+r.solidFill.schemeClr._val];const t=new o(r.solidFill,this._theme);if(a=t.color,t.alpha){const e=+t.alpha/1e5;a=(a+Math.floor(255*e).toString(16)).toLocaleUpperCase()}}i.push({size:+r._sz/100/3*4,bold:!!r._b,italic:!!r._i,strike:!!r._strike,fontColor:a,underline:!!r._u&&"none"!==r._u,defRpr:r,align:t[s]._algn})}return i}dealLayoutStyle(){var t;const e={};let l=[];l=this._sldLayout.cSld.spTree.sp instanceof Array?this._sldLayout.cSld.spTree.sp:[this._sldLayout.cSld.spTree.sp];for(const i of l){e[(null==(t=i.nvSpPr.nvPr.ph)?void 0:t._type)||"other"]=this.dealTexStyle(i.txBody.lstStyle)}return e}getLayoutStyle(t,e="0"){return(this._layoutStyle[t]||[])[+e]||{}}getTextStyle(t,e="0"){switch(t){case"title":return this._titleLvlPprs[+e];case"body":return this._bodyLvlPprs[+e];case"other":return this._otherLvlPprs[+e]}return null}getFont(t){let e=this._theme.fontScheme.minorFont;return t?(e=t.indexOf("+mn")>-1?this._theme.fontScheme.minorFont:this._theme.fontScheme.majorFont,t.indexOf("lt")>-1?e.latin._typeface:t.indexOf("ea")>-1?e.ea._typeface:e.cs._typeface||"Arial"):e.latin._typeface}get shapes(){var t,e,l,i,s,r,n;const c=[];for(const g of this._sps){let v="";(null==(t=g.nvSpPr.nvPr.ph)?void 0:t._type)&&(v=g.nvSpPr.nvPr.ph._type);const S=m[v]||v||"other",x=g.spPr.xfrm;let b;g.nvSpPr.cNvSpPr._txBox?b={id:d(),type:"text",left:_(x.off._x),top:_(x.off._y),width:_(x.ext._cx),height:_(x.ext._cy),rotate:Math.floor(+(x._rot||"0")/6e4),name:g.nvSpPr.cNvPr._name,align:"left",wordSpace:0,lineHeight:1.2,content:[]}:(b={id:d(),fixedRatio:!1,left:_(x.off._x),top:_(x.off._y),width:_(x.ext._cx),height:_(x.ext._cy),rotate:Math.floor(+(x._rot||"0")/6e4),type:"shape",name:g.nvSpPr.cNvPr._name,shape:u[null==(e=g.spPr.prstGeom)?void 0:e._prst]||"rect",align:"center",lineHeight:1.2,wordSpace:0,content:[]},g.nvSpPr.cNvSpPr.spLocks&&(b.fixedRatio=!0));let P=[];P=g.txBody.p instanceof Array?g.txBody.p:[g.txBody.p];for(const t of P){const e=this.getTextStyle(S,t._lvl),a=this.getLayoutStyle(v,t._lvl);if((null==(l=t.pPr)?void 0:l._algn)?b.align={ctr:"center",l:"left",r:"right"}[t.pPr._algn]||"left":a.align&&(b.align={ctr:"center",l:"left",r:"right"}[a.align]),t.r){const l=[];let n=[];n=t.r instanceof Array?t.r:[t.r];for(const t of n){let n=a.fontColor||e.fontColor||"#000000";if(t.rPr.solidFill){t.rPr.solidFill.schemeClr&&(t.rPr.solidFill.schemeClr._val=this._sldMaster.clrMap["_"+t.rPr.solidFill.schemeClr._val]||t.rPr.solidFill.schemeClr._val);const e=new o(t.rPr.solidFill,this._theme);if(n=e.color,e.alpha){const t=+e.alpha/1e5;n=(n+Math.floor(255*t).toString(16)).toLocaleUpperCase()}}if(t.t.__text){const o=(null==(i=t.rPr.latin)?void 0:i._typeface)||(null==(s=t.rPr.ea)?void 0:s._typeface)||this.getFont((null==(r=t.rPr.sym)?void 0:r._typeface)||""),h=y.find((t=>t.label===o)),c=h?h.value:o;for(const i of t.t.__text){const s={value:i,fontSize:t.rPr._sz?+t.rPr._sz/100/3*4:a.size||e.size,width:24,height:24,fontStyle:t.rPr._i||a.italic||e.italic?"italic":"normal",fontWeight:t.rPr._b||a.bold||e.bold?"bold":"normal",fontFamily:c,fontColor:n,underline:!!t.rPr._u&&"none"!==t.rPr._u||a.underline||e.underline,strikout:!!t.rPr._strike},{width:r,height:o}=this.getFontSize(s);s.width=r,s.height=o,l.push(s)}}}const h=l.length-1,c=h>-1?l[h]:{},p={fontSize:e.size,width:24,height:24,fontStyle:e.italic?"italic":"normal",fontWeight:e.bold?"bold":"normal",fontFamily:e.fontFamily,fontColor:e.fontColor,underline:e.underline,strikout:e.strike,...c,value:"\n"};l.push(p),b.content=b.content.concat(l)}}const F=new p(g.style,this._theme);if(!g.spPr.noFill)if(g.spPr.solidFill){const t=new o(g.spPr.solidFill,this._theme),e=+t.alpha/1e3;b.fill={color:t.color,opacity:e}}else if(g.spPr.gradFill){const t=new h(g.spPr.gradFill,this._theme);b.gradient={type:t.type,color:t.color.map((t=>({offset:+t.pos/1e5,value:t.value}))),rotate:t.rotate}}else F.fill&&(b.fill={color:F.fill});if(g.spPr.ln){const t=g.spPr.ln;if(!t.noFill&&t.solidFill){const e=new o(t.solidFill,this._theme),l=+e.alpha/1e3,i=_(t._w||"12700");b.outline={color:e.color,opacity:l,width:i}}}else F.ln&&(b.outline={color:F.ln,width:_("12700")});if(x._flipH&&(b.flipH=-1),x._flipV&&(b.flipV=-1),null==(n=g.spPr.effectLst)?void 0:n.outerShdw){const t=g.spPr.effectLst.outerShdw,e=new a(t,this._theme),l=(e.color+Math.floor(255*+e.alpha/1e5).toString(16)).toLocaleUpperCase(),i=f(+t._dir||0),s=_(t._dist||0),r=s*Math.sin((90-i)/180*Math.PI),o=s*Math.sin(i/180*Math.PI);b.shadow={color:l,h:r,v:o,blur:_(t._blurRad||0)}}c.push(b)}return c}}class S{constructor(t,l){e(this,"_cxnSps"),e(this,"_theme"),this._theme=l;const i=t instanceof Array;this._cxnSps=i?t:[t]}get lines(){var t,e,l;const i=[];for(const s of this._cxnSps){const r=new p(s.style,this._theme),a={id:d(),left:_(s.spPr.xfrm.off._x),top:_(s.spPr.xfrm.off._y),start:[0,0],end:[_(s.spPr.xfrm.ext._cx),_(s.spPr.xfrm.ext._cy)],type:"line",name:s.nvCxnSpPr.cNvPr._name,style:"solid",color:r.ln,startStyle:"",endStyle:"",borderWidth:2,opacity:0};if(s.spPr.ln){const i=s.spPr.ln;if(i.solidFill){const t=new o(i.solidFill,this._theme);a.color=t.color,a.opacity=+t.alpha/1e3}a.style=(null==(t=i.prstDash)?void 0:t._val)||"solid",a.borderWidth=_(i._w||"12700"),a.startStyle=(null==(e=i.headEnd)?void 0:e._type)||"",a.endStyle=(null==(l=i.tailEnd)?void 0:l._type)||""}i.push(a)}return i}}class x{constructor(t,l,i){e(this,"_pics"),e(this,"_theme"),e(this,"_relationships"),this._theme=l,this._relationships=i;const s=t instanceof Array;this._pics=s?t:[t]}get pictures(){var t;const e=[];for(const l of this._pics){const i=l.spPr.xfrm,{videoFile:s,audioFile:r}=l.nvPicPr.nvPr,h={id:d(),fixedRatio:!1,left:_(i.off._x),top:_(i.off._y),width:_(i.ext._cx),height:_(i.ext._cy),type:s?"video":r?"audio":"image",name:l.nvPicPr.cNvPr._name,rotate:Math.floor(+(i._rot||"0")/6e4),streach:0,src:""};if(l.nvPicPr.cNvPicPr.picLocks&&(h.fixedRatio=!0),i._flipH&&(h.flipH=-1),i._flipV&&(h.flipV=-1),l.blipFill){const t=new n(l.blipFill,this._relationships);h.src=(null==t?void 0:t.src.replace("..","ppt"))||"",(s||r)&&(h.cover=h.src),h.opacity=t.opacity}if(s){const t=s["_r:link"],e=this._relationships.find((e=>e._Id===t));h.src=(null==e?void 0:e._Target.replace("..","ppt"))||""}if(r){const t=r["_r:link"],e=this._relationships.find((e=>e._Id===t));h.src=(null==e?void 0:e._Target.replace("..","ppt"))||""}if(l.spPr.solidFill){const t=new o(l.spPr.solidFill,this._theme),e=+t.alpha/1e3;h.fill={color:t.color,opacity:e}}if(l.spPr.ln){const t=l.spPr.ln;if(!t.noFill&&t.solidFill){const e=new o(t.solidFill,this._theme),l=+e.alpha/1e3,i=_(t._w||"12700");h.outline={color:e.color,opacity:l,width:i}}}if(null==(t=l.spPr.effectLst)?void 0:t.outerShdw){const t=l.spPr.effectLst.outerShdw,e=new a(t,this._theme),i=(e.color+Math.floor(255*+e.alpha/1e5).toString(16)).toLocaleUpperCase(),s=f(+t._dir||0),r=_(t._dist||0),o=r*Math.sin((90-s)/180*Math.PI),n=r*Math.sin(s/180*Math.PI);h.shadow={color:i,h:o,v:n,blur:_(t._blurRad||0)}}e.push(h)}return e}}class b{constructor(t,l,i,s){e(this,"_graphicFrames"),e(this,"_relationships"),e(this,"_zip"),e(this,"_x2js"),this._relationships=l,this._zip=i,this._x2js=s;const r=t instanceof Array;this._graphicFrames=r?t:[t]}dealSeries(t){let e=[];const l=[],i=[];for(const s of t)e=s.cat.strRef.strCache.pt.map((t=>t.v.__text)),l.push(s.tx.strRef.strCache.pt.v.__text),i.push(s.val.numRef.numCache.pt.map((t=>+t.v.__text)));return{labels:e,legends:l,series:i}}async getGraphicFrames(){const t=[];for(const e of this._graphicFrames){if(e.graphic.graphicData.chart){const l=e.graphic.graphicData.chart["_r:id"],i=this._relationships.find((t=>t._Id===l)),s=(null==i?void 0:i._Target.replace("..","ppt"))||"",r=await this._zip.file(s).async("string"),a=this._x2js.xml2js(r),o=e.xfrm,n={id:d(),fixedRatio:!1,left:_(o.off._x),top:_(o.off._y),width:_(o.ext._cx),height:_(o.ext._cy),type:"chart",chartType:"bar",axisTransformation:!1,src:"",streach:0,name:e.nvGraphicFramePr.cNvPr._name,rotate:Math.floor(+(o._rot||"0")/6e4),data:{labels:[],legends:[],series:[]}};if(a.chartSpace.chart.plotArea.barChart){const t=a.chartSpace.chart.plotArea.barChart;n.chartType="bar";const e=this.dealSeries(t.ser);n.axisTransformation="bar"===t.barDir._val,n.data=e}if(a.chartSpace.chart.plotArea.lineChart){const t=a.chartSpace.chart.plotArea.lineChart;n.chartType="line";const e=this.dealSeries(t.ser);n.data=e}if(a.chartSpace.chart.plotArea.pieChart){const t=a.chartSpace.chart.plotArea.pieChart;n.chartType="pie";const e=this.dealSeries([t.ser]);n.data=e}t.push(n)}e.graphic.graphicData.tbl}return t}}class P{constructor(t,l,i,s,r,a,o,n){e(this,"_slide"),e(this,"_relationships"),e(this,"_theme"),e(this,"_index",""),e(this,"_zip"),e(this,"_x2js"),e(this,"_sldMaster"),e(this,"_sldLayout"),this._slide=t,this._relationships=l.Relationships.Relationship,this._theme=i,this._index=s,this._zip=r,this._x2js=a,this._sldMaster=n,this._sldLayout=o}async getSlide(){let t;if(this._slide.cSld.bg){const e=new c(this._slide.cSld.bg,this._theme,this._relationships);if(t={type:e.type},"solid"===e.type&&(t.color=e.color),"image"===e.type){const l=e.imageSrc.replace(/.+\./,""),i=await this._zip.file(e.imageSrc).async("base64");t.image=`data:image/${l};base64,`+i,t.imageSize=e.stretch?"cover":"repeat"}"gradient"===e.type&&(t.gradientColor=e.gradientColor,t.gradientType=e.gradientType,t.gradientRotate=e.gradientRotate)}let e=[];if(this._slide.cSld.spTree.sp){const t=new v(this._slide.cSld.spTree.sp,this._theme,this._sldLayout,this._sldMaster);e=e.concat(t.shapes)}if(this._slide.cSld.spTree.cxnSp){const t=new S(this._slide.cSld.spTree.cxnSp,this._theme);e=e.concat(t.lines)}if(this._slide.cSld.spTree.pic){const t=new x(this._slide.cSld.spTree.pic,this._theme,this._relationships).pictures;for(const e of t){const t=e.src.replace(/.+\./,"");if("image"===e.type){const l=await this._zip.file(e.src).async("base64");e.src=`data:image/${t};base64,`+l}else{if(e.cover){const t=e.cover.replace(/.+\./,""),l=await this._zip.file(e.cover).async("base64");e.cover=`data:image/${t};base64,`+l}const l=await this._zip.file(e.src).async("base64");e.src=`data:${e.type}/${t};base64,`+l}}e=e.concat(t)}if(this._slide.cSld.spTree.graphicFrame){const t=new b(this._slide.cSld.spTree.graphicFrame,this._relationships,this._zip,this._x2js),l=await t.getGraphicFrames();e=e.concat(l)}return{index:+this._index,id:d(),elements:e,...t?{background:t}:{}}}}class F{constructor(){e(this,"slides",[])}async read(t){const e=new i,s=new l,a=await s.loadAsync(t),o={};for(const l in a.files)if(!a.files[l].dir){const t=a.files[l].name;if(/.xml$/.test(t)||/.rels$/.test(t)){const i=await a.file(a.files[l].name).async("string");o[t]=e.xml2js(i)}}const n=o["ppt/theme/theme1.xml"],h=new r(n).theme,c=o["ppt/slideMasters/slideMaster1.xml"],p=[];try{for(const t in o)if(/ppt\/slides\/slide[\d]+.xml$/.test(t)){const l=/\d+/.exec(t)[0],i=o[`ppt/slides/_rels/slide${l}.xml.rels`];let s;for(const t of i.Relationships.Relationship)if(/slideLayout[\d]+.xml$/.test(t._Target)){s=o[t._Target.replace("..","ppt")]}const r=new P(o[t].sld,i,h,l,a,e,s.sldLayout,c.sldMaster),n=await r.getSlide();p.push(n)}return p.sort(((t,e)=>t.index-e.index)).map((t=>(delete t.index,t)))}catch(d){return console.error(d),p}}}export{F as A};
